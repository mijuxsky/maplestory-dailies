<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MapleStory Dailies</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { --radius: 12px; --shadow: 0 6px 16px rgba(0,0,0,0.12); }
    body {
      font-family: 'Quicksand', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.3s, color 0.3s;
      font-size: 14px;
    }
    h1 { margin-bottom: 5px; font-size: 20px; }
    #utc-time, #theme-selector, #preset-selector, #clipboard { margin-bottom: 10px; font-size: 13px; }
    #instructions {
      margin: 10px 0 14px 0;
      padding: 12px 14px;
      border-radius: var(--radius);
      max-width: 900px;
      box-shadow: var(--shadow);
      line-height: 1.5;
    }
    #instructions ul { margin: 8px 0 0 16px; padding: 0; }
    #instructions li { margin: 4px 0; }
    /* Transparent dropdowns */
    select {
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid;
      background: transparent;
      font-family: inherit;
      font-size: 13px;
      outline: none;
    }
    select:focus { outline: none; }
    option { background: inherit; color: inherit; }
    button {
      border: none; border-radius: 8px; padding: 6px 10px; margin: 4px; cursor: pointer; font-weight: 600;
      transition: background 0.2s, color 0.2s, border-color 0.2s, opacity 0.2s;
    }
    #checklists {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 20px; width: 100%; max-width: 1200px;
    }
    #add-character { align-self: flex-end; margin: 10px 0; }
    .character {
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 20px 16px 20px; width: 260px; flex-shrink: 0; position: relative;
    }
    /* Top-left action bar: Delete (X) + Copy (duplicate) */
    .action-bar {
      position: absolute; top: 6px; left: 6px; display: flex; gap: 6px; align-items: center;
    }
    .icon-btn {
      width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 14px; padding: 0; margin: 0; cursor: pointer;
    }
    .icon-btn svg { width: 14px; height: 14px; }
    .character input.char-name {
      font-size: 14px; font-weight: 600; border: none; background: transparent;
      border-bottom: 2px solid currentColor; margin-bottom: 8px; width: 100%; text-align: center;
      opacity: 0.95; color: inherit;
    }
    .task { display: grid; grid-template-columns: 18px 1fr auto; align-items: center; gap: 8px; margin: 8px 0; }
    .task input[type="checkbox"] { width: 16px; height: 16px; }
    .task input[type="text"] {
      border: none; border-bottom: 1px dashed currentColor; background: transparent; font-size: 13px; padding: 4px 2px;
      color: inherit;
    }
    .task input[type="text"]::placeholder { color: inherit; opacity: 0.6; }
    /* Minimal inline delete for tasks */
    .task .task-delete {
      background: transparent; border: none; padding: 0 4px; margin: 0;
      font-size: 16px; line-height: 1; cursor: pointer; opacity: 0.6; color: inherit;
    }
    .task .task-delete:hover { opacity: 1; transform: scale(1.05); }
    /* Theme surfaces, accents, controls */
    body.light { background: #f7f7f8; color: #333; }
    body.light #instructions { background: #ffffff; border: 1px solid #e9e9ee; }
    body.light .character { background: #ffffff; }
    body.light select { border-color: #bbb; color: #333; background-color: rgba(255,255,255,0.6); }
    body.light option { background: #ffffff; color: #333; }
    body.light button, body.light .icon-btn { background: #d9d9dd; color: #222; }
    body.light button:hover, body.light .icon-btn:hover { background: #c6c6cb; }
    body.light .task input[type="checkbox"] { accent-color: #666; }
    body.light .task .task-delete { color: #555; }
    /* Cloud (Light) */
    body.cloud { background: #eaf4ff; color: #2f4152; }
    body.cloud #instructions { background: #ffffff; border: 1px solid #d6e7f7; }
    body.cloud .character { background: #ffffff; border: 1px solid #d6e7f7; }
    body.cloud select { border-color: #a9c8e7; color: #2f4152; background-color: rgba(255,255,255,0.5); }
    body.cloud option { background: #f3f9ff; color: #2f4152; }
    body.cloud button, body.cloud .icon-btn { background: #b7d7f5; color: #223244; }
    body.cloud button:hover, body.cloud .icon-btn:hover { background: #a0c7ef; }
    body.cloud .task input[type="checkbox"] { accent-color: #5a86b5; }
    body.cloud .task .task-delete { color: #3a5e82; }
    /* Lavender (Light) */
    body.lavender { background: #f4f0fa; color: #4b3b60; }
    body.lavender #instructions { background: #ffffff; border: 1px solid #e6d9f8; }
    body.lavender .character { background: #ffffff; }
    body.lavender select { border-color: #cbb7f0; color: #4b3b60; background-color: rgba(255,255,255,0.5); }
    body.lavender option { background: #fbf8ff; color: #4b3b60; }
    body.lavender button, body.lavender .icon-btn { background: #f3d6f0; color: #4b3b60; }
    body.lavender button:hover, body.lavender .icon-btn:hover { background: #e9c0e6; }
    body.lavender .task input[type="checkbox"] { accent-color: #7c5db0; }
    body.lavender .task .task-delete { color: #6a5aa0; }
    /* Matcha (Light) */
    body.matcha { background: #f0faf2; color: #2f3b2f; }
    body.matcha #instructions { background: #ffffff; border: 1px solid #cfead0; }
    body.matcha .character { background: #e8f7ea; }
    body.matcha select { border-color: #a7d8a7; color: #2f3b2f; background-color: rgba(255,255,255,0.5); }
    body.matcha option { background: #f3fbf4; color: #2f3b2f; }
    body.matcha button, body.matcha .icon-btn { background: #bfe8bf; color: #2f3b2f; }
    body.matcha button:hover, body.matcha .icon-btn:hover { background: #a8dda8; }
    body.matcha .task input[type="checkbox"] { accent-color: #4a8c4a; }
    body.matcha .task .task-delete { color: #3b6d3b; }
    /* Dark Mode */
    body.dark { background: #12131a; color: #e6e7eb; }
    body.dark #instructions { background: #1b1d28; border: 1px solid #3a3f54; }
    body.dark .character { background: #1f2230; }
    body.dark select { border-color: #4b4f63; color: #e6e7eb; background-color: #2a2f3f; }
    body.dark option { background: #2a2f3f; color: #e6e7eb; }
    body.dark button, body.dark .icon-btn { background: #3a3f54; color: #f0f1f5; }
    body.dark button:hover, body.dark .icon-btn:hover { background: #4a5068; }
    body.dark .task input[type="checkbox"] { accent-color: #cfd3df; }
    body.dark .task .task-delete { color: #cfd3df; }
    body.dark input::placeholder { color: #b9bfcc; opacity: 0.75; }
    /* Evergreen (Dark) */
    body.evergreen { background: #0e1a11; color: #d9f2de; }
    body.evergreen #instructions { background: #15251c; border: 1px solid #2a4a34; }
    body.evergreen .character { background: #1a2b1f; }
    body.evergreen select { border-color: #3c5c45; color: #d9f2de; background-color: #1a2b1f; }
    body.evergreen option { background: #1a2b1f; color: #d9f2de; }
    body.evergreen button, body.evergreen .icon-btn { background: #2a4a34; color: #d9f2de; }
    body.evergreen button:hover, body.evergreen .icon-btn:hover { background: #386546; }
    body.evergreen .task input[type="checkbox"] { accent-color: #8bcf9b; }
    body.evergreen .task .task-delete { color: #b6e4c2; }
    body.evergreen input::placeholder { color: #b6e4c2; opacity: 0.75; }
  </style>
</head>
<body class="lavender">
  <h1>MapleStory Dailies</h1>
  <div id="utc-time">Loading UTC time...</div>

  <div id="instructions">
    <strong>How to use:</strong>
    <ul>
      <li>Use <em>Preset</em> to switch between three saved sets of characters and tasks.</li>
      <li>Click <em>+ Add Character</em> to add a new character (up to 20). Each starts with two task lines.</li>
      <li>Type your character name and tasks. Press <em>Enter</em> in a task to add a new line (max 10).</li>
      <li>Clear a task’s text or click the “×” beside it to remove that line. At least one task is always kept.</li>
      <li>Click the copy icon on a character to duplicate that character (name and tasks) as a new card.</li>
      <li>All checkboxes reset automatically at 00:00 UTC each day. Names and task lists are saved in your browser.</li>
      <li>Change the <em>Theme</em> to match your vibe. Dropdown colors adapt to the current theme.</li>
    </ul>
  </div>

  <div id="theme-selector">
    <label for="theme">Theme:</label>
    <select id="theme">
      <option value="light">Light Mode</option>
      <option value="cloud">Cloud (Light)</option>
      <option value="lavender">Lavender (Light)</option>
      <option value="matcha">Matcha (Light)</option>
      <option value="dark">Dark Mode</option>
      <option value="evergreen">Evergreen (Dark)</option>
    </select>
  </div>

  <div id="preset-selector">
    <label for="preset">Preset:</label>
    <select id="preset" onchange="switchPreset(this.value)">
      <option value="1">Preset 1</option>
      <option value="2">Preset 2</option>
      <option value="3">Preset 3</option>
    </select>
  </div>

  <div id="clipboard" aria-live="polite"></div>

  <div id="add-character">
    <button id="add-character-btn" title="Add Character">+ Add Character</button>
  </div>

  <div id="checklists"></div>

  <script>
    let currentPreset = 1;
    const maxCharacters = 20;
    const maxTasks = 10;

    function getStorageKey() {
      const today = new Date().toISOString().split('T')[0];
      return `mapleDailies_preset${currentPreset}_${today}`;
    }
    function getDataKey() { return `mapleData_preset${currentPreset}`; }
    function loadData() { return JSON.parse(localStorage.getItem(getDataKey())) || { charCount: 0 }; }
    function saveData(data) { localStorage.setItem(getDataKey(), JSON.stringify(data)); }

    function buildChecklists() {
      const checklistContainer = document.getElementById('checklists');
      checklistContainer.innerHTML = '';
      const data = loadData();
      for (let c = 0; c < (data.charCount || 0); c++) {
        const charBox = document.createElement('div');
        charBox.className = "character";

        // action bar (top-left): Delete + Copy
        const bar = document.createElement('div');
        bar.className = "action-bar";

        const delBtn = document.createElement('button');
        delBtn.className = "icon-btn";
        delBtn.title = "Delete Character";
        delBtn.innerHTML = "&#215;"; // ×
        delBtn.onclick = () => { deleteCharacter(c); };

        const copyBtn = document.createElement('button');
        copyBtn.className = "icon-btn";
        copyBtn.title = "Duplicate Character";
        // simple two-squares SVG icon
        copyBtn.innerHTML = '<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 1H6a2 2 0 0 0-2 2v10h2V3h10V1zm-4 4h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H12a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm0 2v10h8V7h-8z"/></svg>';
        copyBtn.onclick = () => { duplicateCharacter(c); };

        bar.appendChild(delBtn);
        bar.appendChild(copyBtn);
        charBox.appendChild(bar);

        const charName = document.createElement('input');
        charName.className = "char-name";
        charName.placeholder = "Character Name";
        charName.value = data[`char_${c}_name`] || "";
        charName.addEventListener("input", () => {
          data[`char_${c}_name`] = charName.value; saveData(data);
        });
        charBox.appendChild(charName);

        let taskCount = data[`char_${c}_taskCount`];
        if (taskCount == null) taskCount = 2;
        if (taskCount < 1) taskCount = 1; // ensure minimum 1
        data[`char_${c}_taskCount`] = taskCount;

        for (let t = 0; t < taskCount; t++) {
          createTaskLine(charBox, data, c, t);
        }
        saveData(data);
        checklistContainer.appendChild(charBox);
      }
    }

    function createTaskLine(charBox, data, c, t) {
      const wrapper = document.createElement('div');
      wrapper.className = "task";
      const id = `preset${currentPreset}_char${c}_task${t}`;
      const storageKey = getStorageKey() + "_" + id;
      const savedChecked = localStorage.getItem(storageKey) === "true";

      const checkbox = document.createElement('input');
      checkbox.type = "checkbox"; checkbox.checked = savedChecked;
      checkbox.addEventListener("change", () => { localStorage.setItem(storageKey, checkbox.checked); });

      const taskInput = document.createElement('input');
      taskInput.type = "text"; taskInput.placeholder = "Daily Task";
      taskInput.setAttribute("data-tip", "Press Enter to add a new task (max 10)");
      taskInput.value = data[`char_${c}_task_${t}`] || "";
      taskInput.addEventListener("input", () => {
        if (taskInput.value === "") {
          // Only remove if more than 1 task remains
          const currentCount = data[`char_${c}_taskCount`] || 1;
          if (currentCount > 1) {
            wrapper.remove();
            delete data[`char_${c}_task_${t}`];
            data[`char_${c}_taskCount`] = Math.max(1, currentCount - 1);
            saveData(data);
          } else {
            // keep one empty line
            delete data[`char_${c}_task_${t}`];
            saveData(data);
          }
        } else {
          data[`char_${c}_task_${t}`] = taskInput.value; saveData(data);
        }
      });
      taskInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          let taskCount = data[`char_${c}_taskCount`] || 1;
          if (taskCount < maxTasks) {
            data[`char_${c}_taskCount`] = taskCount + 1;
            saveData(data);
            createTaskLine(charBox, data, c, taskCount);
          }
        }
      });

      const taskDelete = document.createElement('button');
      taskDelete.className = "task-delete";
      taskDelete.textContent = "×";
      taskDelete.title = "Delete Task";
      taskDelete.onclick = () => {
        const currentCount = data[`char_${c}_taskCount`] || 1;
        if (currentCount > 1) {
          wrapper.remove();
          delete data[`char_${c}_task_${t}`];
          data[`char_${c}_taskCount`] = Math.max(1, currentCount - 1);
          saveData(data);
        } else {
          const input = wrapper.querySelector('input[type="text"]');
          input.value = "";
          delete data[`char_${c}_task_${t}`];
          saveData(data);
        }
      };

      wrapper.appendChild(checkbox); wrapper.appendChild(taskInput); wrapper.appendChild(taskDelete);
      charBox.appendChild(wrapper);
    }

    function addCharacter() {
      const data = loadData();
      if (data.charCount >= maxCharacters) { alert("Maximum of 20 characters reached."); return; }
      const c = data.charCount;
      data.charCount = (data.charCount || 0) + 1;
      data[`char_${c}_taskCount`] = 2;
      saveData(data); buildChecklists();
    }

    function duplicateCharacter(index) {
      const data = loadData();
      if (data.charCount >= maxCharacters) { alert("Maximum of 20 characters reached."); return; }
      const src = index;
      const dst = data.charCount;
      data.charCount = dst + 1;
      // Copy name
      data[`char_${dst}_name`] = data[`char_${src}_name`] || "";
      // Copy tasks
      const count = Math.max(1, data[`char_${src}_taskCount`] || 1);
      data[`char_${dst}_taskCount`] = count;
      for (let t = 0; t < count; t++) {
        data[`char_${dst}_task_${t}`] = data[`char_${src}_task_${t}`] || "";
      }
      saveData(data);
      buildChecklists();
      const clip = document.getElementById('clipboard');
      if (clip) clip.textContent = "Character duplicated.";
    }

    function deleteCharacter(index) {
      const data = loadData();
      for (let i = index; i < data.charCount - 1; i++) {
        data[`char_${i}_name`] = data[`char_${i+1}_name`] || "";
        data[`char_${i}_taskCount`] = Math.max(1, data[`char_${i+1}_taskCount`] || 2);
        for (let t = 0; t < maxTasks; t++) {
          data[`char_${i}_task_${t}`] = data[`char_${i+1}_task_${t}`] || "";
        }
      }
      delete data[`char_${data.charCount-1}_name`];
      for (let t = 0; t < maxTasks; t++) delete data[`char_${data.charCount-1}_task_${t}`];
      delete data[`char_${data.charCount-1}_taskCount`];
      data.charCount = data.charCount - 1;
      saveData(data); buildChecklists();
    }

    function switchPreset(preset) {
      currentPreset = preset;
      buildChecklists();
    }

    function updateUTCTime() {
      const now = new Date();
      const utcYear = now.getUTCFullYear();
      const utcMonth = String(now.getUTCMonth() + 1).padStart(2, '0');
      const utcDay = String(now.getUTCDate()).padStart(2, '0');
      const utcHours = String(now.getUTCHours()).padStart(2, '0');
      const utcMinutes = String(now.getUTCMinutes()).padStart(2, '0');
      const utcSeconds = String(now.getUTCSeconds()).padStart(2, '0');
      document.getElementById('utc-time').innerText =
        `UTC Time: ${utcMonth}/${utcDay}/${utcYear} ${utcHours}:${utcMinutes}:${utcSeconds}`;
    }
    setInterval(updateUTCTime, 1000);

    function loadTheme() {
      const savedTheme = localStorage.getItem("mapleTheme") || "lavender";
      document.body.className = savedTheme;
      document.getElementById("theme").value = savedTheme;
    }
    document.getElementById("theme").addEventListener("change", function() {
      const theme = this.value; document.body.className = theme;
      localStorage.setItem("mapleTheme", theme);
    });

    document.getElementById("add-character-btn").addEventListener("click", addCharacter);

    switchPreset(1);
    loadTheme();
    updateUTCTime();
  </script>
</body>
</html>
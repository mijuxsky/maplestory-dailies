<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MapleStory Dailies</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
  /* ===== Core tokens ===== */
  :root{
    --radius:12px; --shadow:0 6px 16px rgba(0,0,0,.12);
    --ui:14px; --overlay:rgba(0,0,0,.55);

    /* base palette (Lavender defaults) */
    --bg:#f4f0fa; --fg:#4b3b60;
    --card-bg:#ffffff; --card-border:#e6def6;

    --control-bg:#ffffff; --control-fg:#4b3b60; --control-border:#cfc4ea;
    --button-bg:#e7def7; --button-fg:#3c2e54; --button-border:#cfc4ea;

    --icon:#7c5db0; --icon-hover:rgba(124,93,176,.14);
    --task-underline:1px dotted currentColor;
    --name-underline:1px solid currentColor;

    --meta-fg:#6b7280; --handle-fg: var(--meta-fg);
    --popover-bg:var(--card-bg); --popover-fg:var(--fg); --popover-border:var(--card-border);
    --kbd-focus: var(--icon);

    --danger:#E57373;                  /* error / danger */
    --accent:#7c5db0;                  /* theme accent (Important) */
    --accent-tint: rgba(124,93,176,.10);
    --danger-tint: rgba(229,115,115,.12);

    --line-height:1.45; --letter-spacing:normal;
  }

  /* ===== Light themes ===== */
  body.light{ /* Light Mode (Light) */
    --bg:#f7f7f8; --fg:#333;
    --card-bg:#fff; --card-border:#e7e7ea;

    --control-bg:#fff; --control-fg:#222; --control-border:#d8d8dc;
    --button-bg:#ededf1; --button-fg:#222; --button-border:#d8d8dc;

    --icon:#555; --icon-hover:rgba(0,0,0,.07);
    --meta-fg:#6b7280; --handle-fg:#7b8190;

    --popover-bg:#fff; --popover-fg:#222; --popover-border:#e7e7ea;
    --kbd-focus:#3b82f6;

    --danger:#D46B6B;
    --accent:#444; --accent-tint:rgba(0,0,0,.06);
    --danger-tint:rgba(212,107,107,.14);
  }

  body.cloud{ /* Cloud (Light) */
    --bg:#eaf4ff; --fg:#2f4152;
    --card-bg:#fff; --card-border:#d6e7f7;

    --control-bg:#f6fbff; --control-fg:#2f4152; --control-border:#c7def2;
    --button-bg:#dcebfb; --button-fg:#213444; --button-border:#c4dcf5;

    --icon:#5a86b5; --icon-hover:rgba(90,134,181,.14);
    --meta-fg:#566170; --handle-fg:#5a86b5;

    --popover-bg:#ffffff; --popover-fg:#2f4152; --popover-border:#d6e7f7;
    --kbd-focus:#3b82f6;

    --danger:#D36A6A;
    --accent:#5a86b5; --accent-tint:rgba(90,134,181,.12);
    --danger-tint:rgba(211,106,106,.14);
  }

  body.lavender{ /* Lavender (Light) */
    --bg:#f4f0fa; --fg:#4b3b60;
    --card-bg:#fff; --card-border:#e6def6;

    --control-bg:#fff; --control-fg:#4b3b60; --control-border:#cfc4ea;
    --button-bg:#e7def7; --button-fg:#3c2e54; --button-border:#cfc4ea;

    --icon:#7c5db0; --icon-hover:rgba(124,93,176,.14);
    --meta-fg:#6b7280; --handle-fg:#7c5db0;

    --popover-bg:#fff; --popover-fg:#3c2e54; --popover-border:#e6def6;
    --kbd-focus:#7c5db0;

    --danger:#E57373;
    --accent:#7c5db0; --accent-tint:rgba(124,93,176,.12);
    --danger-tint:rgba(229,115,115,.14);
  }

  body.matcha{ /* Matcha (Light) */
    --bg:#f0faf2; --fg:#2f3b2f;
    --card-bg:#e8f7ea; --card-border:#cfead4;

    --control-bg:#f7fdf8; --control-fg:#2f3b2f; --control-border:#cfead4;
    --button-bg:#d9f0de; --button-fg:#243224; --button-border:#c6e4cc;

    --icon:#4a8c4a; --icon-hover:rgba(74,140,74,.14);
    --meta-fg:#55625a; --handle-fg:#4a8c4a;

    --popover-bg:#ffffff; --popover-fg:#243224; --popover-border:#cfead4;
    --kbd-focus:#4a8c4a;

    --danger:#D06E6E;
    --accent:#4a8c4a; --accent-tint:rgba(74,140,74,.12);
    --danger-tint:rgba(208,110,110,.14);
  }

  body.milktea{ /* Milk Tea (Light) */
    --bg:#f6f1ea; --fg:#3a2e2a;
    --card-bg:#ffffff; --card-border:#e6d8c9;

    --control-bg:#fffaf3; --control-fg:#3a2e2a; --control-border:#e1d3c3;
    --button-bg:#efe5d9; --button-fg:#2f2623; --button-border:#e1d3c3;

    --icon:#7a5a3d; --icon-hover:rgba(122,90,61,.14);
    --meta-fg:#6b615b; --handle-fg:#7a5a3d;

    --popover-bg:#ffffff; --popover-fg:#2f2623; --popover-border:#e6d8c9;
    --kbd-focus:#7a5a3d;

    --danger:#C76565;
    --accent:#7a5a3d; --accent-tint:rgba(122,90,61,.12);
    --danger-tint:rgba(199,101,101,.14);
  }

  /* ===== Dark themes ===== */
  body.dark{ /* Dark Mode (Dark) */
    --bg:#12131a; --fg:#e6e7eb;
    --card-bg:#1f2230; --card-border:#2c3144;

    --control-bg:#171925; --control-fg:#e6e7eb; --control-border:#2c3144;
    --button-bg:#2a2e42; --button-fg:#e6e7eb; --button-border:#3a4161;

    --icon:#cfd3df; --icon-hover:rgba(255,255,255,.09);
    --meta-fg:#cbd5e1; --handle-fg:#cfd3df;

    --popover-bg:#1c2030; --popover-fg:#e6e7eb; --popover-border:#2c3144;
    --kbd-focus:#8bcf9b;

    --danger:#FF8A80;
    --accent:#cfd3df; --accent-tint:rgba(207,211,223,.12);
    --danger-tint:rgba(255,138,128,.14);
  }

  body.darkpurple{ /* Dark Purple (Dark) */
    --bg:#0f0b14; --fg:#ece9f8;
    --card-bg:#1a1424; --card-border:#2b2140;

    --control-bg:#130e1d; --control-fg:#ece9f8; --control-border:#2b2140;
    --button-bg:#2a2140; --button-fg:#ece9f8; --button-border:#3a2f5d;

    --icon:#cbb6ff; --icon-hover:rgba(203,182,255,.12);
    --meta-fg:#d5d0e6; --handle-fg:#cbb6ff;

    --popover-bg:#171126; --popover-fg:#ece9f8; --popover-border:#322954;
    --kbd-focus:#b79cff;

    --danger:#FF8AA3;
    --accent:#b79cff; --accent-tint:rgba(183,156,255,.14);
    --danger-tint:rgba(255,138,163,.14);
  }

  body.midnight{ /* Midnight Blue (Dark) */
    --bg:#0b1220; --fg:#e3ecff;
    --card-bg:#141d2b; --card-border:#22324a;

    --control-bg:#101827; --control-fg:#e3ecff; --control-border:#22324a;
    --button-bg:#1f2b42; --button-fg:#e3ecff; --button-border:#2a4066;

    --icon:#9ccaff; --icon-hover:rgba(156,202,255,.14);
    --meta-fg:#cfe0ff; --handle-fg:#9ccaff;

    --popover-bg:#0f1726; --popover-fg:#e3ecff; --popover-border:#2a4066;
    --kbd-focus:#73a7ff;

    --danger:#FF8A80;
    --accent:#73a7ff; --accent-tint:rgba(115,167,255,.14);
    --danger-tint:rgba(255,138,128,.14);
  }

  body.evergreen{ /* Evergreen (Dark) */
    --bg:#0e1a11; --fg:#d9f2de;
    --card-bg:#1a2b1f; --card-border:#25402d;

    --control-bg:#132417; --control-fg:#d9f2de; --control-border:#284833;
    --button-bg:#23402c; --button-fg:#d9f2de; --button-border:#2e5640;

    --icon:#8bcf9b; --icon-hover:rgba(139,207,155,.15);
    --meta-fg:#d1d5db; --handle-fg:#8bcf9b;

    --popover-bg:#15261b; --popover-fg:#d9f2de; --popover-border:#2e5640;
    --kbd-focus:#8bcf9b;

    --danger:#FF9A8D;
    --accent:#8bcf9b; --accent-tint:rgba(139,207,155,.14);
    --danger-tint:rgba(255,154,141,.14);
  }

  body.mocha{ /* Mocha (Dark) */
    --bg:#1b1512; --fg:#efe6de;
    --card-bg:#261d19; --card-border:#3a2a23;

    --control-bg:#1f1916; --control-fg:#efe6de; --control-border:#3a2a23;
    --button-bg:#2b211d; --button-fg:#efe6de; --button-border:#46352c;

    --icon:#e0c7b5; --icon-hover:rgba(224,199,181,.14);
    --meta-fg:#e2d6cd; --handle-fg:#e0c7b5;

    --popover-bg:#201916; --popover-fg:#efe6de; --popover-border:#46352c;
    --kbd-focus:#e6b890;

    --danger:#FF8E7F;
    --accent:#c79a79; --accent-tint:rgba(199,154,121,.16);
    --danger-tint:rgba(255,142,127,.16);
  }

  /* ===== Base layout / components (existing styles preserved) ===== */
  *{box-sizing:border-box}
  body{font-family:Quicksand,system-ui,sans-serif;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;font-size:var(--ui);background:var(--bg);color:var(--fg);transition:.25s background,.25s color;line-height:var(--line-height);letter-spacing:var(--letter-spacing)}
  h1{margin:0 0 6px;font-size:20px;text-align:center}
  #utc-time{font-size:13px;margin-bottom:8px}

  .theme-row{display:flex;gap:10px;align-items:center;width:100%;max-width:1000px;margin:4px 0 8px}
  .select-wrap{position:relative;display:inline-flex;align-items:center}
  .select-wrap::after{content:'‚ñæ';position:absolute;right:10px;pointer-events:none;opacity:.8;color:var(--control-fg);font-size:12px}
  select{appearance:none;padding:6px 28px 6px 10px;border-radius:10px;border:1px solid var(--control-border);background:var(--control-bg);color:var(--control-fg);outline:none;font-family:inherit;font-size:var(--ui)}
  option{background:var(--control-bg);color:var(--control-fg)}
  label{font-weight:600;font-size:var(--ui);opacity:.9;font-family:inherit}

  #instructions{position:relative;width:100%;max-width:1000px;margin:10px 0 10px;padding:12px 14px 12px;border-radius:12px;box-shadow:var(--shadow);background:var(--card-bg);border:1px solid var(--card-border)}
  #instructions.minimized ul{display:none}
  #instr-toggle{position:absolute;top:8px;right:10px;padding:4px 10px;font-size:12px;background:var(--button-bg);color:var(--button-fg);border:1px solid var(--button-border);border-radius:8px;cursor:pointer;font-family:inherit}
  #instructions ul{margin:0;padding-left:18px}

  .toolbar{display:flex;align-items:center;gap:12px;width:100%;max-width:1000px;margin:8px 0 12px}
  .toolbar .left{display:flex;align-items:center;gap:10px;margin-right:auto}
  .toolbar .right{display:flex;align-items:center;gap:10px;margin-left:auto}

  .btn{padding:8px 12px;border-radius:10px;background:var(--button-bg);color:var(--button-fg);border:1px solid var(--button-border);font-weight:600;font-family:inherit;font-size:var(--ui);cursor:pointer}
  .btn:hover{filter:brightness(1.02)}
  .btn:active{transform:translateY(1px)}

  .icon-btn{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0;border:1px solid var(--control-border);background:var(--control-bg);color:var(--icon);transition:.15s;font-family:inherit}
  .icon-btn:hover{background:var(--icon-hover)}
  .icon-btn.small{width:24px;height:24px;border-radius:6px}
  .icon-btn svg{width:16px;height:16px}

  #checklists{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;width:100%;max-width:1000px;align-items:start}
  .character{border-radius:12px;box-shadow:var(--shadow);min-height:120px;position:relative;user-select:none;font-size:var(--ui);background:var(--card-bg);border:1px solid var(--card-border);padding:40px 16px 12px;transition:transform .22s ease,box-shadow .22s ease}
  .character.dragging{opacity:.9;box-shadow:0 10px 24px rgba(0,0,0,.18)}
  .window-controls-right{position:absolute;top:6px;right:8px;display:flex;gap:6px;align-items:center}
  .window-controls-left{position:absolute;top:6px;left:8px;display:flex;gap:6px;align-items:center}
  .card-drag-handle{position:absolute;left:14px;right:14px;top:30px;height:18px;cursor:grab;user-select:none;opacity:0;border:none}
  .card-drag-handle:active{cursor:grabbing}

  .char-image-wrap{text-align:center;margin:2px auto 2px;min-height:24px}
  .char-image-wrap img{max-width:150px;max-height:110px;border-radius:8px;display:inline-block}
  .char-meta{text-align:center;font-size:12px;color:var(--meta-fg);margin:0 0 2px;font-family:inherit;min-height:16px}
  .inline-msg{text-align:center;font-size:12px;margin:2px 0 0;color:var(--danger);display:none}

  .name-row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
  .char-name{width:100%;border:none;background:transparent;border-bottom:var(--name-underline);text-align:center;font-weight:600;margin:0 0 2px;font-size:var(--ui);color:var(--fg);font-family:inherit}
  .char-name:focus{outline:none;box-shadow:none;border-bottom:var(--name-underline)}
  .accents-btn{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0;border:1px solid var(--control-border);background:var(--control-bg);color:var(--icon);cursor:pointer;font-family:inherit}
  .accents-btn:hover{background:var(--icon-hover)}
  .accents-btn .accents-icon{font-weight:700;font-size:14px;line-height:1;font-family:inherit}

  .chips{display:flex;gap:6px;align-items:center;margin:4px 0 2px}
  .chip{padding:4px 8px;border-radius:999px;border:1px solid var(--control-border);background:var(--control-bg);color:var(--control-fg);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit}
  .chip.active{background:var(--button-bg);}

  .tasks{margin-top:2px}
  .task{position:relative;display:grid;grid-template-columns:12px 1fr auto auto 14px;gap:8px;align-items:center;margin:6px 0}
  .task .prio-bar{position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px}
  .task.normal .prio-bar{background:transparent}
  .task.important .prio-bar{background:var(--accent)}
  .task.urgent .prio-bar{background:var(--danger)}
  .task.important{background:var(--accent-tint)}
  .task.urgent{background:var(--danger-tint)}
  .task.important .task-text{font-weight:600}
  .task.urgent .task-text{font-weight:700}
  @keyframes pulseGlow{0%{box-shadow:0 0 0 0 rgba(229,115,115,.6)}50%{box-shadow:0 0 0 6px rgba(229,115,115,0)}100%{box-shadow:0 0 0 0 rgba(229,115,115,0)}}
  .prio-bar.glow{animation:pulseGlow .4s ease-out 2;border-radius:4px}

  .task input[type="text"]{border:none;border-bottom:var(--task-underline);background:transparent;padding:2px 2px;font-size:var(--ui);color:var(--fg);font-family:inherit}
  .task input[type="text"]:focus,
  .task input[type="text"]:focus-visible{outline:none !important;box-shadow:none !important;}
  .task .task-delete{background:transparent;border:none;font-size:16px;opacity:.7;color:var(--icon);width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-family:inherit;cursor:pointer}
  .task .prio-btn{background:transparent;border:1px solid var(--control-border);border-radius:6px;width:24px;height:24px;display:flex;align-items:center;justify-content:center;color:var(--control-fg);cursor:pointer}
  .task .prio-btn:hover{background:var(--icon-hover)}
  .task .prio-btn .i{font-size:13px;line-height:1}
  .task input[type="checkbox"]{width:12px;height:12px;vertical-align:middle}
  .task .task-text{min-width:0}
  .handle{cursor:grab;user-select:none;opacity:.7}
  .handle:active{cursor:grabbing}

  .check-all{display:flex;align-items:center;gap:8px;margin:8px 0 0;font-size:12px;color:var(--meta-fg);font-weight:600}
  .check-all label{color:var(--meta-fg);font-weight:700}

  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:1000}
  .modal-overlay.show{display:flex}
  .modal{background:var(--card-bg);color:var(--fg);border:1px solid var(--card-border);border-radius:12px;padding:16px 16px 14px;min-width:320px;max-width:520px;width:min(520px,92vw);box-shadow:0 10px 28px rgba(0,0,0,.22);font-family:inherit}
  .modal h3{margin:0 0 12px;font-size:18px;font-weight:700}
  .modal .actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}
  .btn.secondary{background:var(--control-bg);color:var(--control-fg);border-color:var(--control-border)}

  /* Accessible focus rings */
  .task input[type="checkbox"]:focus-visible,
  .check-all input:focus-visible,
  .accents-btn:focus-visible,
  .icon-btn:focus-visible,
  .task .prio-btn:focus-visible,
  .chip:focus-visible,
  select:focus-visible,
  .btn:focus-visible{outline:2px solid var(--kbd-focus);outline-offset:2px}

  /* Accents popover */
  .acc-pop{position:absolute;z-index:2000;min-width:260px;max-width:min(92vw,420px);background:var(--popover-bg);color:var(--popover-fg);border:1px solid var(--popover-border);border-radius:12px;box-shadow:var(--shadow);padding:10px;display:none;font-family:inherit;font-size:var(--ui);line-height:var(--line-height);letter-spacing:var(--letter-spacing)}
  .acc-pop.show{display:block}
  .acc-head{display:flex;align-items:center;gap:8px;justify-content:space-between;margin-bottom:6px}
  .acc-title{font-weight:700;font-family:inherit}
  .acc-case-toggle{border:1px solid var(--control-border);background:var(--control-bg);color:var(--control-fg);border-radius:8px;padding:2px 8px;font-size:12px;font-family:inherit}
  .acc-close{border:1px solid var(--control-border);background:var(--control-bg);color:var(--control-fg);border-radius:8px;width:26px;height:26px;display:flex;align-items:center;justify-content:center;font-family:inherit}
  .acc-section-label{font-size:12px;opacity:.8;margin:4px 0 4px;font-family:inherit}
  .acc-base,.acc-variants{display:flex;flex-wrap:wrap;gap:6px}
  .acc-btn{border:1px solid var(--control-border);background:var(--control-bg);color:var(--control-fg);border-radius:8px;padding:6px 8px;font-weight:600;cursor:pointer;font-family:inherit}
  .acc-btn:focus-visible{outline:2px solid var(--kbd-focus);outline-offset:2px}
  .acc-hint{font-size:12px;color:var(--danger);margin-top:6px;font-family:inherit}
</style>
</head>
<body class="lavender">
  <h1>MapleStory Dailies</h1>
  <div id="utc-time">UTC Time: --/--/---- --:--:--</div>

  <!-- Theme selector: Light group first (alphabetical), then Dark group (alphabetical) -->
  <div class="theme-row">
    <label for="theme">Theme:</label>
    <div class="select-wrap">
      <select id="theme">
        <!-- Light -->
        <option value="cloud">Cloud (Light)</option>
        <option value="lavender" selected>Lavender (Light)</option>
        <option value="light">Light Mode (Light)</option>
        <option value="matcha">Matcha (Light)</option>
        <option value="milktea">Milk Tea (Light)</option>
        <!-- Dark -->
        <option value="dark">Dark Mode (Dark)</option>
        <option value="darkpurple">Dark Purple (Dark)</option>
        <option value="evergreen">Evergreen (Dark)</option>
        <option value="midnight">Midnight Blue (Dark)</option>
        <option value="mocha">Mocha (Dark)</option>
      </select>
    </div>
  </div>

  <!-- Instructions -->
  <div id="instructions">
    <button id="instr-toggle" type="button" class="btn">Hide</button>
    <strong>How to use:</strong>
    <ul id="howto">
      <li><strong>Themes</strong>: Pick a theme (top-left). Your choice is saved locally.</li>
      <li><strong>Presets</strong>: Choose 1‚Äì3; each stores its own characters and tasks.</li>
      <li><strong>Save / Load</strong>: Save (üíæ) exports JSON; Load (üìÇ) imports it‚Äîno servers needed.</li>
      <li><strong>Add characters</strong>: ‚Äú+ Add Character‚Äù (max 20). Each starts with 2 tasks (min 1, max 10).</li>
      <li><strong>Keyboard</strong>: Up/Down moves between tasks; Enter toggles; Tab inserts a new task below; P cycles priority.</li>
      <li><strong>Reorder cards</strong>: Drag from the invisible strip above the <u>Character Image</u>; or use the Up/Down arrows.</li>
      <li><strong>Reorder tasks</strong>: Drag the ‚ãÆ‚ãÆ handle; checkbox state is preserved.</li>
      <li><strong>Upload avatar</strong>: Use the upload icon to set a custom image (user uploads are never auto-replaced).</li>
      <li><strong>Auto-fill</strong>: Type a Character Name to fetch Level/Job and avatar from Maple Ranks via Worker.</li>
      <li><strong>Reset</strong>: All checkboxes reset daily at 00:00 UTC.</li>
      <li><strong>Accents</strong>: Use the ‚Äú√Ç‚Äù button; Alt+A opens it for the focused field.</li>
    </ul>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="left">
      <button id="add-character-btn" class="btn" title="Add Character">+ Add Character</button>
    </div>
    <div class="right">
      <label for="preset">Preset:</label>
      <div class="select-wrap">
        <select id="preset">
          <option value="1">Preset 1</option>
          <option value="2">Preset 2</option>
          <option value="3">Preset 3</option>
        </select>
      </div>
      <button id="save-btn" class="icon-btn" title="Save" aria-label="Save">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4ZM5 5h10v4H5V5Zm7 14H6v-6h6v6Z"/></svg>
      </button>
      <button id="load-btn" class="icon-btn" title="Load" aria-label="Load">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M5 20h14a2 2 0 0 0 2-2v-5h-2v5H5V6h5V4H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2Zm7-14v6.17l2.59-2.58L16 11l-4 4l-4-4l1.41-1.41L11 12.17V6h1Z"/></svg>
      </button>
      <input id="import-file" type="file" accept="application/json" hidden>
    </div>
  </div>

  <div id="checklists"></div>

  <!-- Confirm Delete -->
  <div id="confirm-overlay" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="confirm-title" aria-modal="true">
      <h3 id="confirm-title">Confirm Delete</h3>
      <p id="confirm-msg">Delete the character: Untitled?</p>
      <div class="actions">
        <button id="confirm-ok" type="button" class="btn">Yes</button>
        <button id="confirm-cancel" type="button" class="btn secondary">No</button>
      </div>
    </div>
  </div>

  <!-- Accents popover -->
  <div id="accents-popover" class="acc-pop" role="dialog" aria-label="Accented characters" aria-modal="false">
    <div class="acc-head">
      <span class="acc-title">Accents</span>
      <div style="display:flex;gap:6px;align-items:center">
        <button id="acc-case" class="acc-case-toggle" type="button" aria-pressed="false" title="Toggle case">Aa</button>
        <button id="acc-close" class="acc-close" type="button" aria-label="Close">√ó</button>
      </div>
    </div>
    <div class="acc-section-label">Letters</div>
    <div id="acc-base" class="acc-base" role="listbox" aria-label="Base letters"></div>
    <div class="acc-section-label" id="acc-var-label" style="display:none;">Variants</div>
    <div id="acc-variants" class="acc-variants" role="grid" aria-label="Variants"></div>
    <div id="acc-hint" class="acc-hint" style="display:none;">Click into a text box first.</div>
  </div>

  <input id="hidden-upload" type="file" accept="image/*" style="display:none" />
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

  <script>
  /* ===== UTC clock (existing) ===== */
  function tickUTC(){
    const n=new Date();
    const y=n.getUTCFullYear(), m=String(n.getUTCMonth()+1).padStart(2,'0'), d=String(n.getUTCDate()).padStart(2,'0');
    const hh=String(n.getUTCHours()).padStart(2,'0'), mm=String(n.getUTCMinutes()).padStart(2,'0'), ss=String(n.getUTCSeconds()).padStart(2,'0');
    document.getElementById("utc-time").textContent=`UTC Time: ${m}/${d}/${y} ${hh}:${mm}:${ss}`;
  }
  setInterval(tickUTC,1000); tickUTC();

  /* ===== Theme apply & persist ===== */
  const themeSel=document.getElementById("theme");
  const stored=localStorage.getItem("mapleTheme");
  const supported=[...themeSel.options].map(o=>o.value);
  const initial = supported.includes(stored) ? stored : (document.body.className || "lavender");
  document.body.className = supported.includes(initial) ? initial : "lavender";
  themeSel.value = document.body.className;

  themeSel.addEventListener("change",()=>{
    document.body.className = themeSel.value;
    localStorage.setItem("mapleTheme", themeSel.value);
  });

  /* ===== (Everything below is your existing logic; left unchanged) ===== */

  const WORKER_URL = "https://ms-avatar-proxy.meehoowee.workers.dev/mapleranks";
  const BASE_MODEL_URL = "https://maplestory.io/api/character/%7B%22itemId%22%3A2000%2C%22version%22%3A%22250%22%7D%2C%7B%22itemId%22%3A12000%2C%22version%22%3A%22250%22%7D/stand1/0?showears=false&showLefEars=false&showHighLefEars=undefined&resize=1&name=&flipX=undefined";
  const MAX_CHARACTERS=20, MAX_TASKS=10;
  const MIN_LOOKUP_LEN=4, DEBOUNCE_MS=500, CACHE_TTL_MS=5*60*1000;
  const DEFAULT_PRIORITY_FIRST = true;
  const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));

  let accOpen=false;
  let lastEditedNameIndex=null;

  /* (The remainder of your JS from the attached file continues unchanged) */
  /* ‚Ä¶ existing presets / build / tasks / drag-drop / accents / worker lookup code ‚Ä¶ */

  // For brevity in this reply, your previously-working JS should remain exactly as in your file.
  // If you need me to reinsert the entire JS verbatim with themes merged, say ‚Äúpaste full JS‚Äù and I‚Äôll include it.
  </script>
</body>
</html>
